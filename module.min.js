(function(){var e=this,t={};t=function(){var e={};var n=Array.prototype,r=Object.prototype,i=Function.prototype;var s=n.slice,o=r.hasOwnProperty;var u=n.forEach;var a=function(t,n,r){if(t==null)return;if(u&&t.forEach===u){t.forEach(n,r)}else if(t.length===+t.length){for(var i=0,s=t.length;i<s;i++){if(i in t&&n.call(r,t[i],i,t)===e)return}}else{for(var a in t){if(o.call(t,a)){if(n.call(r,t[a],a,t)===e)return}}}};var f=function(e){a(s.call(arguments,1),function(t){for(var n in t){if(t[n]!==void 0)e[n]=t[n]}});return e};t.copy=f;return t}(t||{});var t=function(){var e=Array.prototype,n=Object.prototype,r=Function.prototype;var i=n.hasOwnProperty,s=Object.keys;var o=s||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)if(i.call(e,n))t[t.length]=n;return t};t.keys=o;return t}(t?t:{});var n=function(e){var t=this;var n=Array.prototype.slice;var r=Array.prototype.splice;var i=/\s+/;var s={on:function(e,t,n){var r,s,o,u,a;if(!t)return this;e=e.split(i);r=this._callbacks||(this._callbacks={});while(s=e.shift()){a=r[s];o=a?a.tail:{};o.next=u={};o.context=n;o.callback=t;r[s]={tail:u,next:a?a.next:o}}return this},off:function(t,n,r){var s,o,u,a,f,l;if(!(o=this._callbacks))return;if(!(t||n||r)){delete this._callbacks;return this}t=t?t.split(i):e.keys(o);while(s=t.shift()){u=o[s];delete o[s];if(!u||!(n||r))continue;a=u.tail;while((u=u.next)!==a){f=u.callback;l=u.context;if(n&&f!==n||r&&l!==r){this.on(s,f,l)}}}return this},trigger:function(e){var t,r,s,o,u,a,f;if(!(s=this._callbacks))return this;a=s.all;e=e.split(i);f=n.call(arguments,1);while(t=e.shift()){if(r=s[t]){o=r.tail;while((r=r.next)!==o){r.callback.apply(r.context||this,f)}}if(r=a){o=r.tail;u=[t].concat(f);while((r=r.next)!==o){r.callback.apply(r.context||this,u)}}}return this}};return s}.call(this,t);var t=function(e){var t=function(e,t){var n=r(this,e,t);n.extend=this.extend;return n};var n=function(){};var r=function(t,r,i){var s;if(r&&r.hasOwnProperty("constructor")){s=r.constructor}else{s=function(){t.apply(this,arguments)}}e.copy(s,t);n.prototype=t.prototype;s.prototype=new n;if(r)e.copy(s.prototype,r);if(i)e.copy(s,i);s.prototype.constructor=s;s.__super__=t.prototype;return s};e.extend=t;return e}(t||{});var r=function(){function e(e){this._map=e}e.prototype={add:function(e,t){return this._map.SET_SINGLE.apply(this._map,arguments)},get:function(e){return this._map.GET_SINGLE.apply(this._map,arguments)},each:function(e,t){if(typeof e=="string"){return this._map.INVOKE_MULTIPLE_METHOD.apply(this._map,arguments)}else if(typeof e=="function"){return this._map.INVOKE_MULTIPLE_CALLBACK.apply(this._map,arguments)}},eachTry:function(e,t){return this._map.INVOKE_MULTIPLE_METHOD_IF_EXISTS.apply(this._map,arguments)},remove:function(e){if(typeof e=="undefined"){return this._map.REMOVE_MULTIPLE.apply(this._map,arguments)}else if(typeof e=="string"){return this._map.REMOVE_SINGLE.apply(this._map,arguments)}},on:function(e,t,n){var r=function(r,i){r.on(e,function(){Array.prototype.unshift.call(arguments,r,i);t.apply(n||this._map,arguments)})};return this._map.INVOKE_MULTIPLE_CALLBACK.call(this._map,r,n)},off:function(e){Array.prototype.unshift.call(arguments,"off");return this._map.INVOKE_MULTIPLE_METHOD.apply(this._map,arguments)}};return e}();var i=function(e,t,n){function r(e,t){this.map=t.data;this.eventCallbacks=t.callbacks||{};this.name=t.name;this.module=e;return new n(this)}r.prototype={getName:function(){return typeof this.name=="string"?this.name:null},getMapName:function(){var e=this.getName();return e?" object [inside '"+e+"' map]":""},fireEvent:function(e,t,n){if(e&&typeof this.eventCallbacks[e]=="function"){this.eventCallbacks[e].call(this.module,this.name,t,n)}},GET_SINGLE:function(e){if(typeof this.map[e]==="undefined"){this.module.throwException(new Error('Object "'+e+'" was requested but not found.'))}this.fireEvent("get",e,this.map[e]);return this.map[e]},SET_SINGLE:function(n,r){if(typeof r.on==="undefined"){e.copy(r,t)}this.fireEvent("add",n,r);return this.map[n]=r},REMOVE_SINGLE:function(e){this.fireEvent("remove",e,this.map[e]);delete this.map[e]},REMOVE_MULTIPLE:function(){for(var e in this.map){this.REMOVE_SINGLE(e)}},INVOKE_SINGLE_METHOD:function(e,t,n,r,i){if(this.map[e]){try{if(typeof this.map[e][t]=="function"){var s=Array.prototype.slice.call(arguments,2);return this.map[e][t].apply(this.map[e],s)}else{throw new Error("The method '"+t+"()' is not defined on '"+e+"'")}}catch(o){var u=o.message+"\nSo method '"+t+"()' failed on '"+e+"'"+this.getMapName();if(typeof this.map[e]["throwException"]=="function"){this.map[e].throwException.call(this.map[e],o,u)}else{this.module.throwException(o,u)}}}},INVOKE_SINGLE_METHOD_IF_EXISTS:function(e,t,n,r,i){if(this.map[e]&&typeof this.map[e][t]=="function"){var s=Array.prototype.slice.call(arguments,2);return this.map[e][t].apply(this.map[e],s)}},INVOKE_SINGLE_CALLBACK:function(e,t,n){if(this.map[e]){try{return t.call(n||this.map[e],this.map[e],e)}catch(r){if(r.name=="ModuleException"){throw r}else{var i=r.message+"\nSo callback failed on '"+e+"'"+this.getMapName();throw this.module.throwException(r,i)}}}},INVOKE_MULTIPLE_CALLBACK:function(e,t){for(var n in this.map){this.INVOKE_SINGLE_CALLBACK(n,e,t)}},INVOKE_MULTIPLE_METHOD:function(e,t,n,r){for(var i in this.map){var s=Array.prototype.slice.call(arguments,0);Array.prototype.unshift.call(s,i);this.INVOKE_SINGLE_METHOD.apply(this,s)}},INVOKE_MULTIPLE_METHOD_IF_EXISTS:function(e,t,n,r){for(var i in this.map){var s=Array.prototype.slice.call(arguments,0);Array.prototype.unshift.call(s,i);this.INVOKE_SINGLE_METHOD_IF_EXISTS.apply(this,s)}}};return r}(t,n,r);var s=function(e,t,n){var i=typeof $=="undefined"?true:false;var o=function(){if(i){this.throwException(new Error("jQuery / zepto required for DOM manipulation."))}o=function(){}};s=function(n){e.copy(this,t);e.copy(this,n);this._initialize();if(typeof this.initialize=="function"){this.initialize()}};s.extend=e.extend;s.prototype={_initialize:function(){this._={};this.setScope(this.scope);this._processEventsSelector()},$:function(e){o.call(this);return this.$scope.find(e)},start:function(){this.throwException(new Error("Start method has not been implemented on the module."))},stop:function(){this.throwException(new Error("Stop method has not been implemented on the module."))},restart:function(){this.throwException(new Error("Restart method has not been implemented on the module."))},log:function(e){if(typeof console=="object"&&typeof console.log=="function"){var t=this._name?this._name+" : ":"";console.log(t+e)}},setScope:function(e){if(typeof e=="object"&&typeof e.selector!="undefined"){e=e.selector}this.scope=e;this.$scope=i?null:$(this.scope)},show:function(){o.call(this);this.$scope.show()},hide:function(){o.call(this);this.$scope.hide()},createMap:function(e){var t=this._.maps=this._maps||{};t.i=t.i?t.i++:1;e=!e?t.i:e;var r=t[e]={data:{},callbacks:this._mapEvents,name:e};return new n(this,r)},_mapEvents:{add:function(e,t,n){if(typeof n._name==="undefined"){n._name=t}this._bindMapObject("on",e,t,n)},remove:function(e,t,n){this._bindMapObject("off",e,t,n)}},_bindMapObject:function(e,t,n,r){this._bindProperty(e,t+"."+n,r);this._bindProperty(e,t,r,n)},_bindProperty:function(e,t,n,r){var i=this._.eventsMap;var s=function(e){if(typeof r!=="undefined"){return function(){Array.prototype.unshift.call(arguments,n,r);return e.apply(this,arguments)}}else{return e}};if(i[t]){for(var o in i[t]){var u=s(i[t][o]);if(typeof n[e]!=="function"){this.throwException(new Error("Failed hooking up '"+o+"' event on '"+t+"' object as it has no "+e+"() method - No event aggregator is present on "+t+"."))}n[e].call(n,o,u,this)}}},_processEventsSelector:function(){function t(t,n,r){e[t]=typeof e[t]=="undefined"?{}:e[t];e[t][n]=r}var e=this._.eventsMap={};if(typeof this.events=="object"){for(var n in this.events){var r=n.split(" "),i=r[0],s=r[1],o=this.events[n];if(i&&!s&&typeof o=="object"){for(var u in o){var a=u,f=typeof o[u]=="function"?o[u]:false;if(f){t(i,a,f)}}}else if(i&&s&&typeof o=="function"){t(i,s,o)}}}this._setupEventBlacklist()},_setupEventBlacklist:function(){var e=this._.eventsBlacklist={};for(var t in this){if(this.hasOwnProperty(t)&&typeof this[t]=="object"){e[t]=t}}},setEvents:function(){var e=this._.eventsBlacklist;for(var t in this){if(this.hasOwnProperty(t)&&typeof this[t]=="object"&&!e[t]&&!(this[t]instanceof r)){this._bindProperty("off",t,this[t]);this._bindProperty("on",t,this[t])}}},throwException:function(e,t){var n=t?t.split("\n")[0]:"",r;if(t){var i=this._tag?'Occured on "'+this._tag+'" Object:':"";if(n&&n==i){e.message=r=t}else{e.message=r=(i?i+"\n":"")+t}}else{if(e&&e.message){r=e.message}}this.trigger("error",r,e);throw e}};return s}(t,n,i);if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=s}exports.Module=s}else if(typeof define==="function"&&define.amd){define("underscore",function(){return s})}else{e["Module"]=s}}).call(this)