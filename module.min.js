/*! module - v0.1.0 - 2012-12-29
* https://github.com/jameslockwood/module
* Copyright (c) 2012 James Lockwood; Licensed MIT */
(function(){var e=this,t=typeof t!="undefined"?t:{},t=function(){var e={},n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.slice,o=r.hasOwnProperty,u=n.forEach,a=function(t,n,r){if(t===null)return;if(u&&t.forEach===u)t.forEach(n,r);else if(t.length===+t.length){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i,t)===e)return}else for(var a in t)if(o.call(t,a)&&n.call(r,t[a],a,t)===e)return},f=function(e){return a(s.call(arguments,1),function(t){for(var n in t)t[n]!==void 0&&(e[n]=t[n])}),e};return t.copy=f,t}(t||{}),t=function(){var e=Array.prototype,n=Object.prototype,r=Function.prototype,i=n.hasOwnProperty,s=Object.keys,o=s||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)i.call(e,n)&&(t[t.length]=n);return t};return t.keys=o,t}(t?t:{}),t=function(e){var t=function(e,t){var n=r(this,e,t);return n.extend=this.extend,n},n=function(){},r=function(t,r,i){var s;return r&&r.hasOwnProperty("constructor")?s=r.constructor:s=function(){t.apply(this,arguments)},e.copy(s,t),n.prototype=t.prototype,s.prototype=new n,r&&e.copy(s.prototype,r),i&&e.copy(s,i),s.prototype.constructor=s,s.__super__=t.prototype,s};return e.extend=t,e}(t||{}),t=function(e){var n=this,r=Array.prototype.slice,i=Array.prototype.splice,s=/\s+/,o={on:function(e,t,n){var r,i,o,u,a;if(!t)return this;e=e.split(s),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],o=a?a.tail:{},o.next=u={},o.context=n,o.callback=t,r[i]={tail:u,next:a?a.next:o};return this},off:function(t,n,r){var i,o,u,a,f,l;if(!(o=this._callbacks))return;if(!(t||n||r))return delete this._callbacks,this;t=t?t.split(s):e(o);while(i=t.shift()){u=o[i],delete o[i];if(!u||!n&&!r)continue;a=u.tail;while((u=u.next)!==a)f=u.callback,l=u.context,(n&&f!==n||r&&l!==r)&&this.on(i,f,l)}return this},emit:function(e){var t,n,i,o,u,a,f;if(!(i=this._callbacks))return this;a=i.all,e=e.split(s),f=r.call(arguments,1);while(t=e.shift()){if(n=i[t]){o=n.tail;while((n=n.next)!==o)n.callback.apply(n.context||this,f)}if(n=a){o=n.tail,u=[t].concat(f);while((n=n.next)!==o)n.callback.apply(n.context||this,u)}}return this}};return t.EventsAggregator=o,t}(t,t.keys),t=function(e){return e.installEventsTo=function(t){e.copy(t,e.EventsAggregator)},e}(t||{}),n=function(){function e(e){this._map=e}return e.prototype={add:function(e,t){return typeof e=="object"&&typeof t=="undefined"?(this._map.SET_MULTIPLE.apply(this._map,arguments),this):this._map.SET_SINGLE.apply(this._map,arguments)},get:function(e){return this._map.GET_SINGLE.apply(this._map,arguments)},each:function(e,t){return typeof e=="string"?this._map.INVOKE_MULTIPLE_METHOD.apply(this._map,arguments):typeof e=="function"&&this._map.INVOKE_MULTIPLE_CALLBACK.apply(this._map,arguments),this},eachTry:function(e,t){return this._map.INVOKE_MULTIPLE_METHOD_IF_EXISTS.apply(this._map,arguments),this},remove:function(e){return typeof e=="undefined"?this._map.REMOVE_MULTIPLE.apply(this._map,arguments):typeof e=="string"&&this._map.REMOVE_SINGLE.apply(this._map,arguments),this},on:function(e,t,n){var r=function(r,i){r.on(e,function(){Array.prototype.unshift.call(arguments,r,i),t.apply(n||this._map,arguments)})};return this._map.INVOKE_MULTIPLE_CALLBACK.call(this._map,r,n),this},off:function(e){return Array.prototype.unshift.call(arguments,"off"),this._map.INVOKE_MULTIPLE_METHOD.apply(this._map,arguments),this},length:function(){return this._map.length}},e}(),r=function(e,t){function n(e,n){return n=typeof n=="object"?n:{},this.errorHandler=n.errorHandler||function(e){throw e},this.checkName(e,!0),this.name=e,this.map={},this.eventCallbacks=n.callbacks||{},this.callbacksContext=n.callbacksContext||null,this.length=0,new t(this)}return n.prototype={getName:function(){return typeof this.name=="string"?this.name:null},getMapName:function(){var e=this.getName();return e?" object [inside '"+e+"' map]":" object [inside anonymous map]"},checkName:function(e,t){typeof e!="string"&&typeof e!="number"&&this.errorHandler(new Error("Name must be provided")),typeof e=="string"&&(e.split(" ").join("").length<1||e==="")&&this.errorHandler(new Error("Name must not be empty"))},fireEvent:function(e,t,n){e&&typeof this.eventCallbacks[e]=="function"&&this.eventCallbacks[e].call(this.callbacksContext,this.name,t,n)},GET_SINGLE:function(e){return typeof this.map[e]=="undefined"&&this.errorHandler(new Error('Object "'+e+'" was requested but not found.')),this.fireEvent("get",e,this.map[e]),this.map[e]},SET_SINGLE:function(t,n){try{this.checkName(t)}catch(r){var i=r.message+"\nSo failed to add an"+this.getMapName();this.errorHandler(r,i)}return typeof n.on=="undefined"&&e.installEventsTo(n),this.map[t]=n,this.length++,this.fireEvent("add",t,n),n},SET_MULTIPLE:function(e){typeof e!="object"&&this.errorHandler(new Error("Cannot set multiple map objects - mappings argument is not an object."));for(var t in e){var n=t,r=e[t];typeof r!="object"&&this.errorHandler(new Error("Map object not found - was of type "+typeof r)),this.SET_SINGLE(n,r)}return this},REMOVE_SINGLE:function(e){return this.fireEvent("remove",e,this.map[e]),typeof this.map[e]!="undefined"&&(this.map[e]=null,delete this.map[e],this.length--),this},REMOVE_MULTIPLE:function(){for(var e in this.map)this.REMOVE_SINGLE(e);return this},INVOKE_SINGLE_METHOD:function(e,t,n,r,i){if(this.map[e])try{if(typeof this.map[e][t]=="function"){var s=Array.prototype.slice.call(arguments,2);return this.map[e][t].apply(this.map[e],s)}throw new Error('The method "'+t+'()" is not defined on '+e+".")}catch(o){var u=o.message+"\nSo method '"+t+"()' failed on '"+e+"'"+this.getMapName();this.errorHandler(o,u)}},INVOKE_SINGLE_METHOD_IF_EXISTS:function(e,t,n,r,i){if(this.map[e]&&typeof this.map[e][t]=="function"){var s=Array.prototype.slice.call(arguments,2);return this.map[e][t].apply(this.map[e],s)}},INVOKE_SINGLE_CALLBACK:function(e,t,n){if(this.map[e])try{return t.call(n||this.map[e],this.map[e],e)}catch(r){if(r.name=="ModuleException")throw r;var i=r.message+"\nSo callback failed on '"+e+"'"+this.getMapName();this.errorHandler(r,i)}},INVOKE_MULTIPLE_CALLBACK:function(e,t){for(var n in this.map)this.INVOKE_SINGLE_CALLBACK(n,e,t);return this},INVOKE_MULTIPLE_METHOD:function(e,t,n,r){for(var i in this.map){var s=Array.prototype.slice.call(arguments,0);Array.prototype.unshift.call(s,i),this.INVOKE_SINGLE_METHOD.apply(this,s)}return this},INVOKE_MULTIPLE_METHOD_IF_EXISTS:function(e,t,n,r){for(var i in this.map){var s=Array.prototype.slice.call(arguments,0);Array.prototype.unshift.call(s,i),this.INVOKE_SINGLE_METHOD_IF_EXISTS.apply(this,s)}return this}},n}(t,n),i=function(e,t,n){var r=typeof $=="undefined"?!0:!1,s=function(){r&&this.throwException(new Error("jQuery / zepto required for DOM manipulation.")),s=function(){}};return i=function(t){e.installEventsTo(this),e.copy(this,t),this._initialize(),typeof this.initialize=="function"&&this.initialize()},i.extend=e.extend,i.prototype={_initialize:function(){this._={},this.setScope(this.scope),this._processEventsSelector()},$:function(e){return s.call(this),this.$scope.find(e)},start:function(){this.throwException(new Error("Start method has not been implemented on the module."))},stop:function(){this.throwException(new Error("Stop method has not been implemented on the module."))},log:function(e){typeof console=="object"&&typeof console.log=="function"&&(this._name&&Array.prototype.unshift.call(arguments,this._name+":"),console.log.apply(console,arguments))},setScope:function(e){typeof e=="object"&&typeof e.selector!="undefined"&&(e=e.selector),this.scope=e,this.$scope=r?null:$(this.scope)},show:function(){s.call(this),this.$scope.show()},hide:function(){s.call(this),this.$scope.hide()},createMap:function(e){typeof e!="undefined"&&typeof e!="string"&&this.throwException(new Error("A map name must be a string.")),this._.mapCount=this._.mapCount?this._.mapCount:0,this._.mapCount++,e=e?e:this._.mapCount;var n=this,r={callbacks:this._mapEvents,callbacksContext:this,errorHandler:function(){n.throwException.apply(n,arguments)}};return new t(e,r)},_mapEvents:{add:function(e,t,n){typeof n._name=="undefined"&&(n._name=t),this._bindMapObject("on",e,t,n)},remove:function(e,t,n){this._bindMapObject("off",e,t,n)}},_bindMapObject:function(e,t,n,r){this._bindProperty(e,t+"."+n,r),this._bindProperty(e,t,r,{name:n})},_bindProperty:function(e,t,n,r){var i=function(e){return typeof r!="undefined"?function(){return Array.prototype.unshift.call(arguments,n,r.name),e.apply(this,arguments)}:e},s=function(r){for(var s in r){var o=r[s];for(var u in o){var a=i(o[u]);typeof n[e]!="function"&&this.throwException(new Error("Failed hooking up '"+s+"' event on '"+t+"' object as it has no "+e+"() method - No event aggregator is present on "+t+".")),n[e].call(n,s,a,this)}}},o=this._getEventHandlers(t);s.call(this,o);if(typeof r!="undefined"){var u=this._getGlobalEventHandlers();s.call(this,u)}},_processEventsSelector:function(){var e=function(e,t,n){if(typeof n=="function")return n;if(typeof n=="string"&&typeof this[n]=="function")return this[n];if(n=="-propagate")return function(){Array.prototype.unshift.call(arguments,t),this.emit.apply(this,arguments)};this.throwException(new Error(n+" not found, so '"+t+"' event could not be bound to '"+e+"' events selector."))};if(typeof this.events=="object")for(var t in this.events){var n=t.split(" "),r=n[0],i=n[1],s=this.events[t],o;if(r&&!i&&typeof s=="object")for(var u in s){var a=u;o=e.call(this,r,a,s[u]),this._registerEventHandler(r,a,o)}else r&&i&&s&&(o=e.call(this,r,i,s),this._registerEventHandler(r,i,o))}this._setupEventBlacklist()},_registerEventHandler:function(e,t,n){arguments.length!==3&&this.throwException(new Error("Cannot register event handler.  Must provide a key, an event, and a callback.")),typeof n!="function"&&this.throwException(new Error("Cannot register event handler.  Supplied callback must be a function")),e=e.split(".*")[0];var r=this._.eventsMap=this._.eventsMap?this._.eventsMap:{};r[e]=typeof r[e]=="undefined"?{}:r[e],r[e][t]=typeof r[e][t]=="undefined"?[]:r[e][t],r[e][t].push(n)},_getEventHandlers:function(e,t){var n=this._.eventsMap=this._.eventsMap?this._.eventsMap:{},r;return e&&!t&&n[e]?r=n[e]:t&&n[e]&&n[e][t]?r=n[e][t]:r=[],r},_getGlobalEventHandlers:function(){var e=this._.eventsMap=this._.eventsMap?this._.eventsMap:{};return e["*"]?e["*"]:{}},_setupEventBlacklist:function(){var e=this._.eventsBlacklist={_callbacks:!0};for(var t in this)this.hasOwnProperty(t)&&typeof this[t]=="object"&&(e[t]=t)},bindEvents:function(){var e=this._.eventsBlacklist;for(var t in this)this.hasOwnProperty(t)&&typeof this[t]=="object"&&!e[t]&&!(this[t]instanceof n)&&(this._bindProperty("off",t,this[t],{name:t}),this._bindProperty("on",t,this[t],{name:t}))},throwException:function(e,t){var n=t?t.split("\n")[0]:"",r;if(t){var i=this._tag?'Occured on "'+this._tag+'" Object:':"";n&&n==i?e.message=r=t:e.message=r=(i?i+"\n":"")+t}else e&&e.message&&(r=e.message);throw this.emit("error",e,r),e}},i}(t,r,n);e.Module=i}).call(this);